{% load static %}
{% block content %}
{% load socialaccount %}
<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>E-mart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KH59H8J');</script>

<!-- End Google Tag Manager -->
    <!-- <link rel="manifest" href="site.webmanifest"> -->
    <link rel="canonical" href="https://getbootstrap.com/docs/4.3/examples/checkout/">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href={% static 'css/bootstrap.min.css' %}>
    <link rel="stylesheet" href={% static 'css/font-awesome.min.css' %}>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet">


    <link href="https://getbootstrap.com/docs/4.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="icon" href={% static './img/uni.png' %} sizes="16x16" type="image/png">
    <style>
        .bd-placeholder-img {
          font-size: 1.125rem;
          text-anchor: middle;
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
        }
  
        @media (min-width: 768px) {
          .bd-placeholder-img-lg {
            font-size: 3.5rem;
          }
        }
        
      </style>
</head>

<body style="background-color: #f2f2f2;">



<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KH59H8J"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <div class="container">
    <a class="navbar-brand js-scroll-trigger" href="/"><img
        src={% static 'img//Universal Adventures Logo.png' %} width="200px">
</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav text-uppercase ml-auto">
          <h2>{{postData.product}}</h2>
       
   </ul>
    </div>
</div>
  </nav>
<div class="container mt-5">

 <div class="row mt-5">
      <div class="col-md-6 mt-5">
    <div class="alert alert-warning mb-0 " style="border-radius: 7px;" role="alert">
      Please complete the booking within : <span id="clockdiv"></span>
    </div>
      </div>
      <div class="col-md-6 mt-5">
      <div class="alert alert-light mb-0 py-1 pr-0" >
        <div class="row">
        <div class="col-md-6 mt-1">
      Need Support? Call Us Now.
    </div>
    <div class="col-md-6">
      <button type="button" class="btn bg-white text-danger " onclick="location.href='tel:8882654593'" style="border: 1px solid #ee4347">+91-8882654593<i class="fas fa-headset mr-2 ml-3" aria-hidden="true"></i>Support</button>
    </div>  
    </div>
    </div>
      </div>
    
 </div>
<div class="row">
  <div class="col-md-6 order-md-1 p-3" >
    <div class="p-3" style="background-color: white;border-radius: 7px;">
      <h4 class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">Booking Summary</span>
      </h4>

      <div class="row mx-2 mb-2" style="display: flex;">
        <div class="col-lg-6 col-md-6 col-sm-6 col-6 p-0 mt-2">
          <h6 class="my-0 p-0" style="display: inline;"><i class="fa fa-calendar" aria-hidden="true"></i> Date : </h6>
          <span class="text-muted " style="display: inline;">{{postData.date}}</span>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-6 p-0 mt-2">
          <h6 class="my-0" style="display: inline;"><i class="fa fa-users" aria-hidden="true"></i> Guests : </h6>
          <span class="text-muted ml-2" style="display: inline;">{{postData.number}} Adult<div id="children2" style="display: inline;">,{{postData.number2}} Child</div></span>
        </div>
        
      </div>




      <ul class="list-group mb-3 mt-3">
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0" style="display: inline;">Adult :</h6>


            <p class="ml-2" style="color: #EE4347;display: inline;"><span class="normal" style="
              text-decoration: line-through; 
              color: rgb(49, 49, 49);   
              padding-right: 10px;
              font-family: 'Avenir', Sans-Serif;
              ">₹ {{postData.adultPrice}}
          </span> <span class="pr" style=" font-weight:700;font-size: 16px;color: #EE4347"> ₹
            {{postData.adultPrice2}}
              </span></p>
            
          </div>
          <span class="text-muted ml-4" style="display: inline;">{{postData.adultPrice}} x {{postData.number}} </span>

          <span class="text-muted">&#8377; {% widthratio postData.adultPrice 1 postData.number %}</span>
        </li>

        <div id="children">
        <li  class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0" style="display: inline;">Child :</h6>
            <p class="ml-2" style="color: #EE4347;display: inline;"><span class="normal" style="text-decoration: line-through;color: rgb(49, 49, 49);   padding-right: 10px;
              font-family: 'Avenir', Sans-Serif;">₹ {{postData.childPrice}}
          </span> <span class="pr" style=" font-weight:700; font-size: 16px;color: #EE4347"> ₹
            {{postData.childPrice2}}
              </span></p>
            </div>
          <span class="text-muted ml-4" style="display: inline;">{{postData.childPrice}} x {{postData.number2}} </span>

          <span class="text-muted">&#8377; {% widthratio postData.childPrice 1 postData.number2 %}</span>
        </li>
      </div>

        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0" style="display: inline;">Booking Fee & Tax :</h6>
          </div>
          <span class="text-muted">&#8377; 0</span>
        </li>
        <li class="list-group-item d-flex justify-content-between bg-light">

          <div class="text-success">
            <h6 class="my-0">Total Discount <span id="discount_display">(Sale)</span></h6>
          </div>
          <span class="text-success" id="green">-&#8377;{{postData.discount}}</span>
 
        </li>
        <div id="pr" style="display: none;">
        <li class="list-group-item d-flex justify-content-between bg-light">

          <div class="text-success">
            <h6 class="my-0">Promo Discount</h6>
          </div>
          <span class="text-success" id="green2"></span>
 
        </li>
      </div>
        <li class="list-group-item d-flex justify-content-between">
          
          <form class="input-group" action="#" id="trackerForm">{% csrf_token %}
            <input type="number" class="form-control" placeholder="Use UA Cash(In Rs)" id="wallet_promo" name="wallet_promo">
            <input type="hidden" class="form-control" value="{{postData.number}}" name="adult_promo">
            <input type="hidden" class="form-control" value="{{postData.number2}}" name="child_promo">
            <div class="input-group-append redeem2">
              <button type="submit" class="btn btn-secondary">Use</button>
            </div>
            <div class="input-group-append remove2" style="display: none;">
              <button onclick=" location.reload();" class="btn btn-secondary">Remove</button>
            </div>
            <div class="invalid-feedback" id="invalid">
              *maximum allowed discount on this product is Rs {{postData.max_discount}} per person.
            </div>
          </form>
       
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <form class="input-group" action="#" id="promoForm">{% csrf_token %}
            <input type="text" class="form-control" placeholder="Promo code" id="promo_code" name="promo_code">
            <div class="input-group-append redeem">
              <button type="submit" class="btn btn-secondary">Redeem</button>
            </div>
            <div class="input-group-append remove" style="display: none;">
              <button onclick=" location.reload();" class="btn btn-secondary">Remove</button>
            </div>
            <div class="invalid-feedback" id="invalid2">
              
            </div>
          </form>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span style="font-size: 20px;font-weight: 700;">Total Amount</span>
          <span style="font-size: 20px;font-weight: 700;" >₹ <span id="tot">{{postData.amount}}</span></span>
        </li>
      </ul>



  </div>
  </div>
  <div class="col-md-6 order-md-2 p-3" >
    <div class="p-3" style="background-color: white;border-radius: 7px;">
    <h4 class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">Guest Detail</span>
      </h4>
    <form method="post" action="/checkout/">
      {% csrf_token %}
      <input type="hidden" name="orderid" id="orderid" value="{{postData.id}}">
      <div class="row">
      <div class=" col-lg-2 col-md-2 col-sm-2 col-2  text-center"> Name* </div><div class=" col-lg-10 col-md-10 col-sm-10 col-10  text-center">  <input type="text" class="form-control" placeholder="Enter Name" name="name" value="{{postData.customerName}}"  required></div>
    </div><br>
    <div class="row">
      <div class=" col-lg-2 col-md-2 col-sm-2 col-2  text-center">Email* </div><div class=" col-lg-10 col-md-10 col-sm-10 col-10  text-center"> <input type="email" class="form-control" name="email" value="{{postData.customerEmail}}" placeholder="you@example.com" required></div>
    </div> <br>
    <div class="row">
      <div class=" col-lg-2 col-md-2 col-sm-2 col-2  text-center"> Phone* </div><div class=" col-lg-10 col-md-10 col-sm-10 col-10  text-center"><input type="tel" class="form-control" id="phone"  name="phone"  placeholder="Phone" required></div>
    </div>
    <input type="hidden" name="number" value="{{postData.number}}" />
    <input type ="hidden" id="amount" name="amount" value="{{postData.amount}}" />
    <input type ="hidden" name="date" value="{{postData.date}}" />
    <input type ="hidden" id="coupon_id"  name="coupon_id" value="" />
     
  </div>

  <div class="p-3 mt-3" style="background-color: white;border-radius: 7px;">
    <div class="row mx-2">
      <div class=" col-lg-6 col-md-6 col-sm-6 col-6  text-center">
        <div class="p-2" style="border: 1px solid black;border-radius: 7px;">
      <div class="custom-control custom-radio">
        <input id="credit" name="paymentMethod" onclick="amount1()" type="radio" class="custom-control-input"  required>
        <label class="custom-control-label" for="credit">Pay Full Amount<br><h4 id="totprice">INR {{postData.amount}}</h4></label>
      </div>
    </div>
      </div>
      <div class=" col-lg-6 col-md-6 col-sm-6 col-6 text-center"> 
        <div class="p-2" style="border: 1px solid black;border-radius: 7px;">
      <div class="custom-control custom-radio ml-2 ">
        <input id="debit" name="paymentMethod" onclick="amount2()" type="radio" class="custom-control-input" required>
        <label class="custom-control-label" for="debit">Pay Partially (30%)<br><h4 id="discountprice"></h4></label>
    </div>
  </div>
      </div>
    </div>
    <div class="form-check mx-3 mt-2">
      <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" required>
      <label class="form-check-label" for="flexCheckDefault">
        I accept Universal Adventur's Payment Policies and Terms & Conditions.
      </label>
    </div>
    <button class="btn btn-primary btn-lg btn-block mt-2"  type="submit" >Make Payment</button>
  </div>
</form> 
</div>

<!-- kk-->
  </div>
</div>
       
</body>
    <script src={% static 'js/vendor/jquery-1.12.4.min.js' %}></script>
    <script src={% static 'js/popper.min.js' %}></script>
    <script src={% static 'js/bootstrap.min.js' %}></script>

    <script src={% static 'js/main.js' %}></script>
<script>
  $('#trackerForm').on('submit', function(e) {
    e.preventDefault();
    e.stopPropagation();
    if(Number($('input[name=wallet_promo]').val())> Number(`{{postData.max_discount}}`)) 
    {
      $('#invalid').css('display','block');
    }
    else{
      $('#invalid').css('display','none');
    var formData = {
            'wallet_promo': $('input[name=wallet_promo]').val(),
            'adult_promo': $('input[name=adult_promo]').val(),
            'child_promo': $('input[name=child_promo]').val(),
            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
        };
        $.ajax({
            type: 'POST',
            url: '/walletpromo/',
            data: formData,
            encode: true
        })

        .done(function(data) {
          data = JSON.parse(data);
          if (data['status'] == 'success') {
            var dis=Number(data['used_amount'])+Number(`{{postData.discount}}`);
            var tot=`{{postData.amount}}`- Number(data['used_amount']);
            $('#green').html('-&#8377;'+' '+ dis);
            $('#tot').html(tot);
            $('#discountprice').html('INR'+ ' ' +tot*0.3)
            $('#totprice').html('INR'+ ' ' +tot)
            $('#discount_display').html('(Sale'+ '+' +'UA wallet)')
            $('.redeem2').css('display','none');
            $('.remove2').css('display','block');
            $("#wallet_promo").prop('disabled', true);
            
          }
        });
      }
});
$('#promoForm').on('submit', function(e) {
    e.preventDefault();
    e.stopPropagation();

    var formData = {
            'promo_code': $('input[name=promo_code]').val(),
            'amount':$('#tot').html(),
            'product':`{{postData.product}}`,
            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
        };
        $.ajax({
            type: 'POST',
            url: '/promocode/',
            data: formData,
            encode: true
        })

        .done(function(data) {
          data = JSON.parse(data);
          if (data['status'] == 'success') {
            var dis=Number(data['used_amount']);
            var tot=Number(data['final_amount']);
            $('#coupon_id').val(data['coupon_id'])
            $('#pr').css('display','block');
            $('#green2').html('-&#8377;'+' '+ dis);
            $('#tot').html(tot);
            $('#discountprice').html('INR'+ ' ' +tot*0.3)
            $('#totprice').html('INR'+ ' ' +tot)
            $('#invalid2').css('display','none');
            $('.redeem').css('display','none');
            $('.remove').css('display','block');
            $("#promo_code").prop('disabled', true);
            
          }
          else if(data['status']=='Expired'){
            $('#invalid2').html('*'+'Coupon Code is Expired');
            $('#invalid2').css('display','block');
          }
          else{
            $('#invalid2').html('*'+data['status']);
            $('#invalid2').css('display','block');
          }
        });

});

var child =`{{postData.number2}}`
  if (child == 0)
  {
    $('#children').css('display','none')
    $('#children2').css('display','none')
  }
  $('#discountprice').html('INR'+ ' ' +`{{postData.amount}}`*0.3)
 
   function amount1()
   { 
     let total_price=$('#totprice').html().split(' ')[1]
     $('#amount').val(total_price)
   }
   function amount2()
   { 
    let dis_price=$('#discountprice').html().split(' ')[1]
     console.log(dis_price)
     $('#amount').val(dis_price)
   }
   
</script>

  <script>
// 10 minutes from now
if (sessionStorage.getItem("counter")) {
     
  var time_in_minutes = sessionStorage.getItem("counter");
    } 
  else {
    var time_in_minutes = 10;
    }
var current_time = Date.parse(new Date());
var deadline = new Date(current_time + time_in_minutes*60*1000);


function time_remaining(endtime){
	var t = Date.parse(endtime) - Date.parse(new Date());
	var seconds = Math.floor( (t/1000) % 60 );
  if (seconds / 10 <1){
    seconds = '0'+seconds
  }
	var minutes = Math.floor( (t/1000/60) % 60 );
	var hours = Math.floor( (t/(1000*60*60)) % 24 );
	var days = Math.floor( t/(1000*60*60*24) );
	return {'total':t, 'days':days, 'hours':hours, 'minutes':minutes, 'seconds':seconds};
}
function run_clock(id,endtime){
	var clock = document.getElementById(id);
	function update_clock(){
		var t = time_remaining(endtime);
		clock.innerHTML = t.minutes +':'+ t.seconds;
    sessionStorage.setItem("counter", t.minutes);
		if(t.total<=0){ clearInterval(timeinterval);sessionStorage.removeItem('counter');window.location.href = '/products/{{postData.slug}}';
            alert("You session has expired due to no activity."); }
	}
	update_clock(); // run function once at first to avoid delay
	var timeinterval = setInterval(update_clock,1000);
}
run_clock('clockdiv',deadline);
</script>
</html>
{% endblock %}